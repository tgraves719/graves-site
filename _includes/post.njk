---
layout: base.njk
---
<section class="py-16">
  <div class="max-w-4xl mx-auto">
    <a href="/blog/" id="back-link" class="interactive-rainbow inline-block mb-8 px-3 py-2 rounded-md">&larr; Back</a>
    <div class="text-center mb-8">
      {% if date %}
      <p class="text-sm text-gray-500 mb-2">{{ date | postDate }}</p>
      {% endif %}
      <h1 class="text-4xl tracking-tight uppercase font-bold text-white" style="letter-spacing: 0.1em;">{{ title }}</h1>
    </div>
    {% if videoId %}
    <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden mb-12 shadow-lg bg-black">
      <iframe src="https://www.youtube.com/embed/{{ videoId }}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full"></iframe>
    </div>
    {% elif image %}
    <img src="/{{ image }}" alt="{{ title }}" class="w-full h-auto rounded-xl mb-12 shadow-lg">
    {% endif %}
    <div class="prose prose-invert prose-lg max-w-none text-gray-300">
      {{ content | safe }}
    </div>
  </div>
</section>

<script>
  // Navigation history-based back button with retry mechanism
  function setupBackButton() {
    const backLink = document.getElementById('back-link');
    if (!backLink) return;
    
    // Get stored navigation history
    const lastPageUrl = sessionStorage.getItem('last-page-url');
    const lastPageTitle = sessionStorage.getItem('last-page-title') || 'Previous Page';
    
    console.log('ğŸ” Navigation history - Last URL:', lastPageUrl);
    console.log('ğŸ” Navigation history - Last Title:', lastPageTitle);
    console.log('ğŸ” Document referrer:', document.referrer);
    console.log('ğŸ” Current URL:', window.location.href);
    
    // Debug: show ALL session storage keys
    console.log('ğŸ” All session storage keys:');
    for (let i = 0; i < sessionStorage.length; i++) {
      const key = sessionStorage.key(i);
      console.log(`  ${key}: ${sessionStorage.getItem(key)}`);
    }
    
    if (lastPageUrl) {
      // Use the stored URL - this is like browser back button behavior
      backLink.href = lastPageUrl;
      
      // Set appropriate back button text based on the URL
      if (lastPageUrl.includes('/work/portraits-of-change/')) {
        backLink.textContent = 'â† Back to Portraits of Change';
      } else if (lastPageUrl.includes('/blog/')) {
        backLink.textContent = 'â† Back to Blog';
      } else {
        // Extract a readable name from the URL or title
        backLink.textContent = 'â† Back';
      }
      
      console.log('âœ… Back button set to:', backLink.href, 'with text:', backLink.textContent);
    } else {
      // Fallback: try to use referrer if available
      const referrer = document.referrer;
      if (referrer && referrer !== window.location.href) {
        if (referrer.includes('/work/portraits-of-change/')) {
          backLink.href = '/work/portraits-of-change/';
          backLink.textContent = 'â† Back to Portraits of Change';
          console.log('âœ… Back button set using referrer: Portraits');
        } else if (referrer.includes('/blog/')) {
          backLink.href = '/blog/';
          backLink.textContent = 'â† Back to Blog';
          console.log('âœ… Back button set using referrer: Blog');
        } else {
          // Default fallback
          backLink.href = '/blog/';
          backLink.textContent = 'â† Back to Blog';
          console.log('âš ï¸ Using default blog fallback');
        }
      } else {
        // Ultimate fallback to blog if no history available
        backLink.href = '/blog/';
        backLink.textContent = 'â† Back to Blog';
        console.log('âš ï¸ No navigation history or referrer found, defaulting to blog');
      }
    }
  }
  
  // Run immediately and also on DOMContentLoaded
  setupBackButton();
  document.addEventListener('DOMContentLoaded', setupBackButton);
  
  // Setup back link page transitions
  function setupBackLinkTransitions() {
    const backLink = document.getElementById('back-link');
    if (!backLink) return;
    
    // Remove existing listeners
    backLink.replaceWith(backLink.cloneNode(true));
    const newBackLink = document.getElementById('back-link');
    
    // Make the back link use smooth page transitions
    newBackLink.addEventListener('click', function(e) {
      e.preventDefault();
      if (typeof PageTransition !== 'undefined') {
        PageTransition.navigateToPage(this.href);
      } else {
        window.location.href = this.href;
      }
    });
  }
  
  // Setup transitions immediately and on DOM ready
  setupBackLinkTransitions();
  document.addEventListener('DOMContentLoaded', setupBackLinkTransitions);
</script>